<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-MessagePack">MessagePack</h1>

<p><a href="http://msgpack.org">MessagePack</a> is an efficient binary
serialization format. It lets you exchange data among multiple languages
like JSON but it&#39;s faster and smaller. For example, small integers
(like flags or error code) are encoded into a single byte, and typical
short strings only require an extra byte in addition to the strings
themselves.</p>

<p>If you ever wished to use JSON for convenience (storing an image with
metadata) but could not for technical reasons (binary data, size, speedâ€¦),
MessagePack is a perfect replacement.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msgpack</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_msgpack'>to_msgpack</span>  <span class='comment'>#=&gt; &quot;\x93\x01\x02\x03&quot;
</span><span class='const'>MessagePack</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; [1,2,3]
</span></code></pre>

<p>Use RubyGems to install:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_msgpack'>msgpack</span>
</code></pre>

<p>or build msgpack-ruby and install:</p>

<pre class="code ruby"><code class="ruby">bundle
rake
gem install --local pkg/msgpack</code></pre>

<h1 id="label-Use+cases">Use cases</h1>
<ul><li>
<p>Create REST API returing MessagePack using Rails + [RABL](<a
href="https://github.com/nesquena/rabl">github.com/nesquena/rabl</a>)</p>
</li><li>
<p>Store objects efficiently serialized by msgpack on memcached or Redis</p>
<ul><li>
<p>In fact Redis supports msgpack in <a
href="http://redis.io/commands/eval">EVAL-scripts</a></p>
</li></ul>
</li><li>
<p>Upload data in efficient format from mobile devices such as smartphones</p>
<ul><li>
<p>MessagePack works on iPhone/iPad and Android. See also <a
href="https://github.com/msgpack/msgpack-objectivec">Objective-C</a> and <a
href="https://github.com/msgpack/msgpack-java">Java</a> implementations</p>
</li></ul>
</li><li>
<p>Design a portable protocol to communicate with embedded devices</p>
<ul><li>
<p>Check also <a href="http://fluentd.org/">Fluentd</a> which is a log
collector which uses msgpack for the log format (they say it uses JSON but
actually it&#39;s msgpack, which is compatible with JSON)</p>
</li></ul>
</li><li>
<p>Exchange objects between software components written in different languages</p>
<ul><li>
<p>You&#39;ll need a flexible but efficient format so that components exchange
objects while keeping compatibility</p>
</li></ul>
</li></ul>

<h1 id="label-Portability">Portability</h1>

<p>MessagePack for Ruby should run on x86, ARM, PowerPC, SPARC and other CPU
architectures.</p>

<p>And it works with MRI (CRuby) and Rubinius. Patches to improve portability
is highly welcomed.</p>

<h1 id="label-Serializing+objects">Serializing objects</h1>

<p>Use <strong>MessagePack.pack</strong> or <strong>to_msgpack</strong>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msgpack</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>  <span class='comment'># or
</span><span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_to_msgpack'>to_msgpack</span>
</code></pre>

<h2 id="label-Streaming+serialization">Streaming serialization</h2>

<p>Packer provides advanced API to serialize objects in streaming style:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># serialize a 2-element array [e1, e2]
</span><span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>Packer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
<span class='id identifier rubyid_pk'>pk</span><span class='period'>.</span><span class='id identifier rubyid_write_array_header'>write_array_header</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_e1'>e1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_e2'>e2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
</code></pre>

<p>See <a href="http://ruby.msgpack.org/MessagePack/Packer.html">API
reference</a> for details.</p>

<h1 id="label-Deserializing+objects">Deserializing objects</h1>

<p>Use <strong>MessagePack.unpack</strong>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msgpack</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
</code></pre>

<h2 id="label-Streaming+deserialization">Streaming deserialization</h2>

<p>Unpacker provides advanced API to deserialize objects in streaming style:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># deserialize objects from an IO
</span><span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>Unpacker</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
<span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_obj'>obj</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>
</code></pre>

<p>or event-driven style which works well with EventMachine:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># event-driven deserialization
</span><span class='kw'>def</span> <span class='id identifier rubyid_on_read'>on_read</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='ivar'>@u</span> <span class='op'>||=</span> <span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>Unpacker</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@u</span><span class='period'>.</span><span class='id identifier rubyid_feed_each'>feed_each</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_obj'>obj</span><span class='op'>|</span>
     <span class='comment'># ...
</span>  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>See <a href="http://ruby.msgpack.org/MessagePack/Unpacker.html">API
reference</a> for details.</p>

<h1 id="label-Serializing+and+deserializing+symbols">Serializing and deserializing symbols</h1>

<p>By default, symbols are serialized as strings:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_packed'>packed</span> <span class='op'>=</span> <span class='symbol'>:symbol</span><span class='period'>.</span><span class='id identifier rubyid_to_msgpack'>to_msgpack</span>     <span class='comment'># =&gt; &quot;\xA6symbol&quot;
</span><span class='const'>MessagePack</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_packed'>packed</span><span class='rparen'>)</span>      <span class='comment'># =&gt; &quot;symbol&quot;
</span></code></pre>

<p>This can be customized by registering an extension type for them:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>DefaultFactory</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x00</span><span class='comma'>,</span> <span class='const'>Symbol</span><span class='rparen'>)</span>

<span class='comment'># symbols now survive round trips
</span><span class='id identifier rubyid_packed'>packed</span> <span class='op'>=</span> <span class='symbol'>:symbol</span><span class='period'>.</span><span class='id identifier rubyid_to_msgpack'>to_msgpack</span>     <span class='comment'># =&gt; &quot;\xc7\x06\x00symbol&quot;
</span><span class='const'>MessagePack</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_packed'>packed</span><span class='rparen'>)</span>      <span class='comment'># =&gt; :symbol
</span></code></pre>

<p>The extension type for symbols is configurable like any other extension
type. For example, to customize how symbols are packed you can just
redefine Symbol#to_msgpack_ext. Doing this gives you an option to prevent
symbols from being serialized altogether by throwing an exception:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Symbol</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_to_msgpack_ext'>to_msgpack_ext</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Serialization of symbols prohibited</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>DefaultFactory</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x00</span><span class='comma'>,</span> <span class='const'>Symbol</span><span class='rparen'>)</span>

<span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:symbol</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>string</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_msgpack'>to_msgpack</span>  <span class='comment'># =&gt; RuntimeError: Serialization of symbols prohibited
</span></code></pre>

<h1 id="label-Extension+Types">Extension Types</h1>

<p>Packer and Unpacker support <a
href="https://github.com/msgpack/msgpack/blob/master/spec.md#types-extension-type">Extension
types of MessagePack</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># register how to serialize custom class at first
</span><span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>Packer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
<span class='id identifier rubyid_pk'>pk</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x01</span><span class='comma'>,</span> <span class='const'>MyClass1</span><span class='comma'>,</span> <span class='symbol'>:to_msgpack_ext</span><span class='rparen'>)</span> <span class='comment'># equal to pk.register_type(0x01, MyClass)
</span><span class='id identifier rubyid_pk'>pk</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x02</span><span class='comma'>,</span> <span class='const'>MyClass2</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_obj'>obj</span><span class='op'>|</span> <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_how_to_serialize'>how_to_serialize</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='comment'># blocks also available
</span>
<span class='comment'># almost same API for unpacker
</span><span class='id identifier rubyid_uk'>uk</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>Unpacker</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='id identifier rubyid_uk'>uk</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x01</span><span class='comma'>,</span> <span class='const'>MyClass1</span><span class='comma'>,</span> <span class='symbol'>:from_msgpack_ext</span><span class='rparen'>)</span>
<span class='id identifier rubyid_uk'>uk</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x02</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='op'>|</span> <span class='const'>MyClass2</span><span class='period'>.</span><span class='id identifier rubyid_create_from_serialized_data'>create_from_serialized_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
</code></pre>

<p>MessagePack::Factory is to create packer and unpacker which have same
extention types.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_factory'>factory</span> <span class='op'>=</span> <span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>Factory</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x01</span><span class='comma'>,</span> <span class='const'>MyClass1</span><span class='rparen'>)</span> <span class='comment'># same with next line
</span><span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x01</span><span class='comma'>,</span> <span class='const'>MyClass1</span><span class='comma'>,</span> <span class='label'>packer:</span> <span class='symbol'>:to_msgpack_ext</span><span class='comma'>,</span> <span class='label'>unpacker:</span> <span class='symbol'>:from_msgpack_ext</span><span class='rparen'>)</span>
<span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_packer'>packer</span><span class='lparen'>(</span><span class='id identifier rubyid_options_for_packer'>options_for_packer</span><span class='rparen'>)</span>
<span class='id identifier rubyid_uk'>uk</span> <span class='op'>=</span> <span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_unpacker'>unpacker</span><span class='lparen'>(</span><span class='id identifier rubyid_options_for_unpacker'>options_for_unpacker</span><span class='rparen'>)</span>
</code></pre>

<p>For <strong>MessagePack.pack</strong> and
<strong>MessagePack.unpack</strong>, default packer/unpacker refer
<strong>MessagePack::DefaultFactory</strong>. Call
<strong>MessagePack::DefaultFactory.register_type</strong> to enable types
process globally.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>MessagePack</span><span class='op'>::</span><span class='const'>DefaultFactory</span><span class='period'>.</span><span class='id identifier rubyid_register_type'>register_type</span><span class='lparen'>(</span><span class='int'>0x03</span><span class='comma'>,</span> <span class='const'>MyClass3</span><span class='rparen'>)</span>
<span class='const'>MessagePack</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='id identifier rubyid_data_with_ext_typeid_03'>data_with_ext_typeid_03</span><span class='rparen'>)</span> <span class='comment'>#=&gt; MyClass3 instance
</span></code></pre>

<h1 id="label-Buffer+API">Buffer API</h1>

<p>MessagePack for Ruby provides a buffer API so that you can read or write
data by hand, not via Packer or Unpacker API.</p>

<p>This <a
href="http://ruby.msgpack.org/MessagePack/Buffer.html">MessagePack::Buffer</a>
is backed with a fixed-length shared memory pool which is very fast for
small data (&lt;= 4KB), and has zero-copy capability which significantly
affects performance to handle large binary data.</p>

<h1 id="label-How+to+build+and+run+tests">How to build and run tests</h1>

<p>Before building msgpack, you need to install bundler and dependencies.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_bundler'>bundler</span>
<span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_install'>install</span>
</code></pre>

<p>Then, you can run the tasks as follows:</p>
<ul><li>
<p>Build</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_build'>build</span>
</code></pre>
</li><li>
<p>Run tests</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_spec'>spec</span>
</code></pre>
</li><li>
<p>Generating docs</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_doc'>doc</span>
</code></pre>
</li></ul>

<h2 id="label-How+to+build+-mingw32+rubygems">How to build -mingw32 rubygems</h2>

<p>MessagePack mingw32/64 rubygems build process uses <a
href="https://github.com/rake-compiler/rake-compiler-dock">rake-compiler-dock</a>.
Run:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rake'>rake</span> <span class='label'>build:</span><span class='id identifier rubyid_windows'>windows</span>
</code></pre>

<p>Once this step successes, target gems exist in
pkg/msgpack-*-x86,x64-mingw32.gem.</p>

<h2 id="label-Updating+documents">Updating documents</h2>

<p>Online documents (<a href="http://ruby.msgpack.org">ruby.msgpack.org</a>)
is generated from gh-pages branch. Following commands update documents in
gh-pages branch:</p>

<pre class="code ruby"><code class="ruby">bundle exec rake doc
git checkout gh-pages
cp doc/* ./ -a</code></pre>

<h1 id="label-Copyright">Copyright</h1>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sadayuki Furuhashi &lt;frsyuki@gmail.com&gt;</p>
</dd><dt>Copyright
<dd>
<p>Copyright Â© 2008-2015 Sadayuki Furuhashi</p>
</dd><dt>License
<dd>
<p>Apache License, Version 2.0</p>
</dd></dl>
</div></div>

    <div id="footer">
  Generated on Wed Dec  6 11:04:27 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.3.1).
</div>

  </body>
</html>